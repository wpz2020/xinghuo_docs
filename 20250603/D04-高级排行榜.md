  * [](/)
  * 局外大厅预制功能
  * D04-高级排行榜

复制链接

本页总览

# D04-高级排行榜

> 相关视频教程  
>
> [【极限猫工作室】局内新排行榜D04教程，新手5分钟就能学会](https://www.bilibili.com/video/BV1xZ421s7EX)  
>
> 【广告时间】做教程得[贡献度](https://doc.sce.xd.com/Manual/GamePublish/AchievementPoint)，贡献度可提现可定制，可高倍率抵扣服务器成本，不知道做什么可以看[悬赏单](https://docs.qq.com/sheet/DYkZUZ3hrRExlaHZL?tab=BB08J2)

## 简介[​](/Manual/Homepage/Rank#简介 "简介的直接链接")

【排行榜】是游戏设计中：可以集中展示游戏结果，给予玩家目标，促进玩家间互动的常用功能，一个恰到好处的排行，往往会对游戏的时长和留存产生正面影响
星火编辑器内预制了【高级排行榜】的功能，只需要简单地配置，即可让玩家感受到“冲榜”的乐趣

## 使用方法[​](/Manual/Homepage/Rank#使用方法 "使用方法的直接链接")

### 排行榜的整体使用流程[​](/Manual/Homepage/Rank#排行榜的整体使用流程 "排行榜的整体使用流程的直接链接")

预制功能库应用排行榜->数编内配置关键参数及显示内容->触编内完成排行榜的逻辑->利用数编的比较函数制定排序规则->在界面编辑器中将其显示出来

### 1\. 预制功能库应用排行榜**[​](/Manual/Homepage/Rank#1-预制功能库应用排行榜 "1.
预制功能库应用排行榜**的直接链接")

将『新-排行榜』（也可能命名为「大厅排行榜-D04」）拖入『游戏机制』下，点击『点击应用所有预制功能』

![](https://doc.sce.xd.com/assets/images/1-c0a12eceb49ef39fb1a0a10b863b4f73.png)

### 2\. 数编内配置关键参数及显示内容**[​](/Manual/Homepage/Rank#2-数编内配置关键参数及显示内容 "2.
数编内配置关键参数及显示内容**的直接链接")

点击『工具按钮』展开下拉列表，点击勾选『排行榜』和『任意数据』

![](https://doc.sce.xd.com/assets/images/2-a8bf5c6dfe05f2a66a13b6367d591b35.png)

这样我们就能在列表里看到『排行榜』和『任意数据』并可以对他们进行配置了！

### 『排行榜』的配置[​](/Manual/Homepage/Rank#排行榜的配置 "『排行榜』的配置的直接链接")

在『排行榜』下新建蓝图，并继承[通用库模板]排行榜

这里星火预制了排行榜模板，可以直接复制粘贴为一个新的蓝图卡片然后简单配置其中的参数即可  具体的使用方法见4.

![](https://doc.sce.xd.com/assets/images/22-9ab8273627611e3632ee815524f32fc5.png)

**排行榜节点字段解析**

![](https://doc.sce.xd.com/assets/images/3-f08da8e0845a6aafa93f96db7bfc0574.png)

字段| 解释| 备注  
---|---|---  
排行榜上线人数| 排行榜可以容纳的人数| 会留10%的余量进行并发处理，保证同时有若干个人上榜时不会出现异常情况  
（服务端）比较函数| 排行榜内数据的排序规则|
没有代码经验的开发者不用太理解，总之就是决定是从大倒下还是从小到大，类似lua中的table.sort()，传入两个数据体作为参数进行比较，并返回true/false决定顺序，返回true为a->b降序排列  
客户端比较函数| 排行榜内数据的排序规则|
大部分情况下和服务端完全相同，复制粘贴即可。比较函数分为客户端比较函数和服务端比较函数，因为服务端不会对所有数据进行完全排序，只会排出n*110%中的前n名，并且在每次排名数据插入时判断排名数据是否可以上榜，准确的排序会在前n名数据发给客户端后在客户端进行  
排行榜唯一key列表| 此ID列内如果有重复项，则保留排名靠前的数据|
举个简单例子：我们不希望某一个玩家完全霸榜，榜上重复出现他的名字，那么就需要把『用户ID』作为排行榜唯一key，让这个玩家最强的数据在榜上即可。只能进行最基本的判断，因此判断重复key字段只能是字符串或者数值类型，不要用复杂类型  
排名数据key列表| 排名列显示内容的key|  
排名数据显示名列表| 排名列显示的内容，需要从key列表内挑选所需的展示在界面上|  
  
③根据自己游戏的需求配置这些字段

『任意数据』的配置

点击[通用库模板]排行榜列表，在卡片上点击加号连接公共节点

![](https://doc.sce.xd.com/assets/images/4-93258ebe06f4e4cf2afbd1c07cb590ea.png)

**3\. 触编内完成排行榜的逻辑**

①新建一个触发器

②按照游戏的设计需求配置触发事件，例如：游戏结束时，完成任务时，玩家进入排行榜区域时等

③新增一个【类型为简单表、key类型为字符串、值类型为任意】的局部变量

![](https://doc.sce.xd.com/assets/images/5-4e20e0c93805c89a9a48523cac5a9553.png)

④动作：设置简单表内key的值

![](https://doc.sce.xd.com/assets/images/6-e9d5fc8ce83a0ed3c83452ec7ea35495.png)

⑤动作：为『数编内添加的排行榜』新增『排行榜数据』

![](https://doc.sce.xd.com/assets/images/7-e883ba5dc2397943cdbe8ee367dd3e99.png)

**4\. 利用数编的比较函数制定排序规则**

①首先可以考虑使用排行榜样例进行修改 （建议右键复制一份再修改，不要在原蓝图卡片上修改）

![](https://doc.sce.xd.com/assets/images/8-256e3add8164a865ec01437a56fb0d0d.png)

②点击打开『编辑函数』，按照需求填写key（需要和蓝图卡片上的排名数据key对应）

![](https://doc.sce.xd.com/assets/images/9-23f12473730f01797e2ee93d52d75f4a.png)

③可以按照规则修改条件分支的内容

![](https://doc.sce.xd.com/assets/images/10-ac3607fa35d52f2c2a2d8de1664ba170.png)

④如果模板不够用，也可以参考链接来自定义你的规则[排序函数文档](http://doc.sce.xd.com/Manual/TriggerEditor/Advanced/Sorting)

**注意：** 排行榜比较函数的返回值为布尔值，和触发器中数组排序中比较函数的返回值（数值）不同。

**5\. 在界面编辑器中将其显示出来**

①在MainPage内添加排行按钮

②点击新增的按钮，在属性面板里选择事件并创建

③执行打开排行榜界面的动作，保存！

![](https://doc.sce.xd.com/assets/images/11-38eafcb33e72290de27ae4db644fa655.png)

![](https://doc.sce.xd.com/assets/images/12-179af3e643b13b5f277598d8e0d44783.png)

### 周期刷新排行榜[​](/Manual/Homepage/Rank#周期刷新排行榜 "周期刷新排行榜的直接链接")

排行榜支持周期性循环刷新，在新建排行榜时选择周期刷新排行榜。

![](https://doc.sce.xd.com/assets/images/23-33a525c17eb7537b92fc46d2ec10a3a5.png)

选择需要的刷新周期。

![](https://doc.sce.xd.com/assets/images/24-458c4ef25e876572f41f04add1381511.png)

### 排行榜奖励发放[​](/Manual/Homepage/Rank#排行榜奖励发放 "排行榜奖励发放的直接链接")

排行榜支持为各个排名梯度的人通过邮件发放奖励，普通排行榜将在排行榜结束后发放奖励，周期刷新排行榜将在每次刷新后结算发放上一次的奖励。

在排行榜的右侧属性中，勾选显示高级属性。

![](https://doc.sce.xd.com/assets/images/25-a98f24a8fccda1c7c016fd4a10f38f44.png)

在排名奖励中进行配置，排名处填写数字，在第一档处填写排名几意为前几名获得该奖励。如上图1-5名为一档奖励，6-10名为二档奖励。奖励邮件文本为发放奖励时邮件里显示的文本，如没有特殊要求可不填写，会显示默认的文本。

此外还需要配置下图的发奖名单key。

![](https://doc.sce.xd.com/assets/images/27-c26692c89a787e89bf122fc3a54ed396.png)

发奖名单key
配置每条数据中，对应的玩家id的字段名，该字段储存的数据有两种方式，一种是单个玩家，储存单个玩家的虚拟id一种是多名玩家，储存玩家虚拟id的数组

![](https://doc.sce.xd.com/assets/images/29-e0e3bc1d4611e7c24adc2a91dcb2db1f.png)

如上图，发奖名单key可填 "单个玩家" 或者 "小队成员"

配置完成后看到的排行榜如下图。

![](https://doc.sce.xd.com/assets/images/26-2182427673ec1486aa98af256d716f13.png)

## 排行榜的一些云变量key[​](/Manual/Homepage/Rank#排行榜的一些云变量key "排行榜的一些云变量key的直接链接")

有的时候会碰到一些情况，需要查询实际储存的排行榜云变量数据，以下列出

其中 #排行榜link#
是你的排行榜节点的link，右键复制粘贴到文本框后可获得，一般配置成单独蓝图（推荐这么配置，不要直接在任意数据中创建节点）以"$$"开头，".root"结尾。

#排行榜link#_rank 列表类型，普通排行榜的排名数据，查询到的会是乱序，需要自行排序

#排行榜link#_award 普通类型，普通排行榜发奖信息留档

#排行榜link#_info 普通类型，周期排行榜的当前轮次信息

#排行榜link#_#轮次号#_rank 列表类型，周期排行榜的排名数据，#轮次号# 是一个数字，可以查询任意轮次的周期排行榜

#排行榜link#_#轮次号#_award 普通类型，周期排行榜发奖信息留档

## 示例[​](/Manual/Homepage/Rank#示例 "示例的直接链接")

我们假设一个场景：
游戏开始3s后（触发事件）排行榜载入完成并可以点击查看，排行榜内展示了对局中所有玩家（key1）在游戏内的：击杀数（key2）、死亡数（key3），并且按照击杀数降序排列，如果击杀数相同时，则按死亡数升序排列（比较函数）

①在数据编辑器里新增排行榜蓝图并配置字段

![](https://doc.sce.xd.com/assets/images/13-41bf06aef4eb39e2a0871c9490ac1491.png)

②在任意数据的排行榜列表中连接公共节点

![](https://doc.sce.xd.com/assets/images/14-531c7129f9c1d45f175b57fec74df84c.png)

③1游戏开始3秒作为触发事件，执行后续动作

④2遍历对局内所有的玩家，拿到他们昵称及自定义属性

⑤3新增一个【类型为简单表、key类型为字符串、值类型为任意】的局部变量

⑥4分别为『排行数据key列表』内的数据设置值

⑦5动作：为『数编内添加的排行榜』新增『排行榜数据』

![](https://doc.sce.xd.com/assets/images/15-4a73dcf564bd5b06b5fe1de28c184fd6.png)

⑧通过数编内的排行蓝图卡片打开比较函数

⑨进行函数的编辑：在kill的值不相同的情况下，按照kill的值降序排列；kill的值相同时，则按照die的值降序排列

![](https://doc.sce.xd.com/assets/images/16-32db6f78794640dd88c91be89d1fb5ef.png)

⑩在界面编辑器中添加按钮并创建点击事件

![](https://doc.sce.xd.com/assets/images/17-9dc257c1e267a8c268c29e698dbf34ee.png)

上面讲了高级排行榜的普遍用法，其实到这里大家已经能做一个很完整的排行榜给玩家体验了，但是如果你是资深开发者！需要更自由的用法！

那么请看！

自定义使用场景

当需要自制排行榜界面或者需要在其他地方展示排行榜数据时，我们可以执行以下动作

## 获取排行榜数据[​](/Manual/Homepage/Rank#获取排行榜数据 "获取排行榜数据的直接链接")

但是需要注意的是：单挑排行榜数据类型不是上文中的简单表，而是一个列表类型云变量，其中的value即之前保存的简单表

![](https://doc.sce.xd.com/assets/images/18-d239976f39b3decc17de39806a565334.png)

## 客户端自行处理数据[​](/Manual/Homepage/Rank#客户端自行处理数据 "客户端自行处理数据的直接链接")

如果你需要自行处理排行数据，那么就需要在服务端获取排行榜数据，然后将数据传输给客户端，并在客户端对获得到的数组使用比较函数进行排序

可以自行写逻辑排序，也可以直接使用客户端排序函数进行排序

需要传入的数据是数组类型，内容为列表类型云变量，其中的value为排名数据简单表

服务端

![](https://doc.sce.xd.com/assets/images/19-47383b74898916d6d9fa917f29871814.png)

![](https://doc.sce.xd.com/assets/images/20-ed304ee70af45f839aff989482697e39.png)

客户端

![](https://doc.sce.xd.com/assets/images/21-fa76dec7a7e5951b014d606f146cb5f2.png)

[上一页D03-大厅签到功能](/Manual/Homepage/HomepageCheckIn)[下一页D05-大厅通行证](/Manual/Homepage/BattlePass)


